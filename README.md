# SqliteWasmHelper

[![.NET Builds](https://github.com/JeremyLikness/SqliteWasmHelper/actions/workflows/build.yml/badge.svg)](https://github.com/JeremyLikness/SqliteWasmHelper/actions/workflows/build.yml)
[![.NET Tests](https://github.com/JeremyLikness/SqliteWasmHelper/actions/workflows/tests.yml/badge.svg)](https://github.com/JeremyLikness/SqliteWasmHelper/actions/workflows/tests.yml)

Download this package from [Nuget](https://www.nuget.org/packages/SqliteWasmHelper/).

`SqliteWasmHelper` is a package designed to make it easy to work with SQLite databases
in Blazor Wasm apps. Although you *could* install [Eric Sink](https://github.com/ericsink)'s 
[SQLitePCLRaw.bundle_e_sqlite3](https://www.nuget.org/packages/SQLitePCLRaw.bundle_e_sqlite3/) 
package directly, that will only provide an in-memory implementation. This package 
automatically injects the code needed to persist your database in cache with the
help of [EF Core](https://docs.microsoft.com/ef). 

^ **WARNING** The browser cache is both easily accessible by the end user and can be flushed
any time. Do not use SQLite in the browser to store sensitive data. Do not use it to store
user-entered data unless the data is temporary in nature or you have a process to synchronize
data to the back end. 

## Quick start

Let's get right to the point!

### Prerequisites

For the Wasm client to get properly linked, you must have the [WebAssembly Tools workload](https://docs.microsoft.com/en-us/core/blazor/webassembly-native-dependencies)
installed.

Add the following to the `.csproj` file for your Blazor WebAssembly project (it can be added to an
existing `PropertyGroup`):

```xml
<PropertyGroup>
   <WasmBuildNative>true</WasmBuildNative>
</PropertyGroup>
```

### Instlallation and use

1. Install the NuGet package (will update this once NuGet is published, for now you can generate
it and reference locally) or reference the `SqliteWasmHelper` project. This automatically
installs all necessary dependencies:
  a. SqliteWasmHelper
  b. Entity Framework Core and the SQLite provider
  c. The SQLitePCLRaw.bundle for running SQLite in WebAssembly
2. Add `using SqliteWasmHelper;` to the top of the `Program.cs` file in your Blazor WebAssembly project
3. Use the extension method to add a special `DbContext` factory:
  ```csharp
  builder.Services.AddSqliteWasmDbContextFactory<ThingContext>(
    opts => opts.UseSqlite("Data Source=things.sqlite3"));
  ```
4. Inject the factory into the components that need it
  ```csharp
  @inject ISqliteWasmDbContextFactory<ThingContext> Factory
  ```
5. Use the `DbContext` as you normally would
   ```csharp
   using var ctx = await Factory.CreateDbContextAsync();
   ctx.Things.Add(new Thing { Name = newThing });
   await ctx.SaveChangesAsync();
   ```
6. If you want access to the file, look at the [GenerateDownloadLinkAsync](docs/IBrowserCache/GenerateDownloadLinkAsync.md) documentation
or use/customize the [BackupLink](https://github.com/JeremyLikness/SqliteWasmHelper/blob/main/SqliteWasmHelper/BackupLink.razor) component.

7. The `BlazorWasmExample` is a working example to show it in use.

## How it works

When your app requests a `DbContext`, the special factory uses JavaScript interop to 
check for the existence of a cache. If the cache exists, it is restored and returned,
otherwise a new database is created. [to be continued...]

## API documentation

Read the autogenerated
[API Docs](SqliteWasmHelper/docs/SqliteWasmHelper.md).

## Release notes

Read the [release notes](./ReleaseNotes.md).

## Summary

Questions? DM [@JeremyLikness](https://twitter.com/JeremyLikness) or open a
[GitHub issue](https://github.com/JeremyLikness/SqliteWasmHelper/issues/new).
